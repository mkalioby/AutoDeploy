{% load render_table from django_tables2 %}

<!DOCTYPE html>
<html>
<head lang="en">

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-control" content="public">
    <title>{{ TITLE }}</title>
    <link rel="stylesheet" href="{{ STATIC_URL }}css/jquery-ui.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}css/jquery-ui.theme.css">
    <link href="{{ STATIC_URL }}css/bootstrap.css" rel="stylesheet" type="text/css"/>
    <link href="{{ STATIC_URL }}css/sb-admin-2.css" rel="stylesheet" type="text/css"/>
    <link href="{{ STATIC_URL }}css/sidebar.css" rel="stylesheet" type="text/css"/>
    <link href="{{ STATIC_URL }}css/font-awesome.css" rel="stylesheet" type="text/css"/>
    <link href="{{ STATIC_URL }}css/metisMenu.css" rel="stylesheet" type="text/css"/>
    <link href="{{ STATIC_URL }}css/morris.css" rel="stylesheet" type="text/css"/>
    <link href="{{ STATIC_URL }}css/screen.css" rel="stylesheet" type="text/css"/>
    <link href="{{ STATIC_URL }}css/autodeploy.css" rel="stylesheet" type="text/css"/>
    <link rel="shortcut icon" href="{{ STATIC_URL }}img/logo.png">
    <link rel="apple-touch-icon" href="{{ STATIC_URL }}img/logo.png">
    <link rel="icon" type="image/png" href="{{ STATIC_URL }}img/logo.png" sizes="192x192">

</head>
<body>
{% include "head.html" %}
<div class="container" style="width: 80%">
    <div id="row" style="min-height: 342px;">
        {% block content %}
            <br/>
            <div align="center">
                <h2>{{ title }}</h2></div>
            {% if ajax %}
                <br/>

                <div align="center" id="content" class="{{ class }}">
                    <img src="{{ STATIC_URL }}/img/loading.gif"/><br/>
                    Please wait while your request is processed.....
                </div>
            {% else %}
                <div align="center" id="content" class="{{ class }}"> {{ text }}</div>
            {% endif %}
        {% endblock %}

    </div>
</div>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/bootstrap.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/sb-admin-2.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/metisMenu.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/morris.js"></script>
{% block head %}

{% endblock %}
<script>
    $(document).ready(function () {
        checkSlack();
    });
</script>
<script src="{{ STATIC_URL }}js/functions.js" type="text/javascript"></script>
{% if ajax %}
    <script type="text/javascript">
        function renderNotification(title, msg) {
            body = $("<div>").html(msg).text();
            var options = {
                body: body,
                //  image: "{{ STATIC_URL }}img/sdl_logo.png",
                icon: "{{ STATIC_URL }}img/logo.png",
                badge: "{{ STATIC_URL }}img/logo.png",
                timestamp: new Date(),
            }

            var n = new Notification(title, options);
        }


        $(document).ready(function () {
            Notification.requestPermission().then(function (result) {
                update();
            });
            checkSlack();
        });
        $.ajax({
            url: "{{ BASE_URL }}api/{{ function }}",
            "method": "GET",
            "dataType": "{{ dataType }}",
            success: function (data) {
                {{ function }}(data)
                {% if function == "cloneCD"  or  function == "cloneCI" %}
                    renderNotification("Cloned Successfully", "Clone of {{ project.name  }} done successfully")
                {% elif function == "deploy" %}
                    renderNotification("Deployed Successfully", "Deployment of {{ project.name  }} done successfully")
                {% elif function == "integrate" %}
                    renderNotification("Integrated Successfully", "Integration of {{ project.name  }} done successfully")
                {% endif %}
            },
            error: function (data) {
                renderResult(data.responseText, "Error")
                {% if function == "cloneCD" or function == "cloneCI" %}
                    title = "Cloning Failed";
                    body = "Cloning of {{ project.name }} failed, please check error";
                {% elif function == 'deploy' %}
                    title = "Deployment Failed";
                    body = "Deployment of {{ project.name  }} failed, please check error";
                {% elif function == 'integrate' %}
                    title = "Integration Failed";
                    body = "Integration of {{ project.name  }} failed, please check error";
                {% endif %}
            }
            {% if data != "" %},
                data:{{ data|safe }}
            {% endif %}
        })


    </script>
{% endif %}
</body>
</html>